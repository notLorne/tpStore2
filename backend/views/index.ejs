<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<style>
  /* Styles for the modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 400px;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .product-image {
  width: 200px;
  height: 200px;
}

</style>

<body>
  <button id="signupButton">S'inscrire</button>
  <button id="loginButton">Se connecter</button>
  <button id="cartButton">Panier</button>

  <!-- Modal Inscription -->
  <div id="signupModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>

      <h2>Inscription</h2>
      <form action="/subscribe" method="post">
        <div>
          <label for="fullname">Nom complet :</label>
          <input type="text" id="fullname" name="fullname" required>
        </div>
        <div>
          <label for="address">Adresse :</label>
          <input type="text" id="address" name="address" required>
        </div>
        <div>
          <label for="age">Âge :</label>
          <input type="number" id="age" name="age" required>
        </div>
        <div>
          <label for="email">Adresse e-mail :</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div>
          <input type="submit" value="S'inscrire">
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Se connecter -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>

      <h2>Connexion</h2>
      <form action="/login" method="post">
        <div>
          <label for="username">Nom d'utilisateur :</label>
          <input type="text" id="username" name="username" required>
        </div>
        <div>
          <label for="password">Mot de passe :</label>
          <input type="password" id="password" name="password" required>
        </div>
        <div>
          <input type="submit" value="Connexion">
        </div>
      </form>
    </div>
  </div>

  <!-- Shopping Cart Modal -->
  <div id="cartModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
  
      <h2>Shopping Cart</h2>
  
      <!-- Display cart items dynamically -->
      <% if (cart && cart.length > 0) { %>
        <ul>
          <% cart.forEach(function(item) { %>
            <li>
              <strong>Product ID:</strong> <%= item.id_produit %>
              <br>
              <strong>Quantity:</strong> <%= item.quantity %>
            </li>
          <% }) %>
        </ul>
      <% } else { %>
        <p>Your cart is empty.</p>
      <% } %>
    </div>
  </div>
  
  <script>
    const signupModal = document.getElementById('signupModal');
    const signupButton = document.getElementById('signupButton');
    const loginModal = document.getElementById('loginModal');
    const loginButton = document.getElementById('loginButton');
    const cartModal = document.getElementById('cartModal');
    const cartButton = document.getElementById('cartButton');
    const closeSpans = document.getElementsByClassName('close');

    signupButton.addEventListener('click', () => {
      signupModal.style.display = 'block';
    });
    loginButton.addEventListener('click', () => {
      loginModal.style.display = 'block';
    });
    cartButton.addEventListener('click', () => {
      cartModal.style.display = 'block';
    });
    for (let i = 0; i < closeSpans.length; i++) {
      closeSpans[i].addEventListener('click', () => {
        const modal = closeSpans[i].closest('.modal');
        modal.style.display = 'none';
      });
    }
    window.addEventListener('click', (event) => {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
      }
    });
  </script>

  <br>
  <br>

  <img src="/assets/blingCover.jpg" alt="Bling Cover Image" style="width: 600px; height: 300px;">

  <h1>MAGASIN DE BIJOUX</h1>

  <br>
  <br>

  <h1>Liste des produits</h1>

  <table>
    <% for (var i = 0; i < produits.length; i += 5) { %>
    <tr>
      <% for (var j = i; j < Math.min(i + 5, produits.length); j++) { %>
        <td>
          <img src="<%= produits[j].image_url %>" alt="Product Image" class="product-image">
          <br>
          <strong><%= produits[j].nom %></strong><br>
          Catégorie: <%= produits[j].categorie %><br>
          Prix: <%= produits[j].prix %><br>
          Matériau: <%= produits[j].materiel %><br>
          Pierre précieuse: <%= produits[j].pierre %><br>
          Carat: <%= produits[j].carat %><br>
          <input type="number" name="quantity-<%= produits[j].id_produit %>" min="0" value="0" style="width: 30px;">
          <button class="add-to-cart" data-product-id="<%= produits[j].id_produit %>">Ajouter au panier</button>
        </td>
      <% } %>
    </tr>
    <% } %>
  </table>

  <script>

document.addEventListener('click', async function(event) {
  if (event.target.classList.contains('add-to-cart')) {
    var button = event.target;
    var productId = button.dataset.productId;
    var quantityInput = button.parentNode.querySelector('input[type="number"]');
    var quantity = parseInt(quantityInput.value);

    // Perform validation or additional checks if needed
    if (quantity > 0) {
      try {
        var response = await fetch('/cart/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id_produit: productId, quantity: quantity })
        });

        if (response.ok) {
          // Handle the response from the server if needed
        } else {
          console.error('Error adding item to cart');
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }
  }
});


  </script>

</body>

</html>
